<!DOCTYPE html>
<layout:html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml"
             xmlns:layout="http://www.w3.org/1999/xhtml" layout:decorate="~{layout}">
    <head>
        <meta charset="UTF-8">
        <title>녹색 저탄소</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
        <link th:href="@{css/common/argon-dashboard.min.css}"/>
        <link rel="stylesheet" th:href="@{/css/index/index.css}">
    </head>

    <th:block layout:fragment="script">
        <script th:src="@{/js/index/index.js}"></script>
    </th:block>

    <div layout:fragment="content">
        <body>
            <main class="main">
                <div class="container-fluid index_container">
                    <div class="row">

                        <!-- 프로필 카드 -->
                        <th:block th:if="${user != null}">
                            <div class="col-md-3">
                                <div class="card card-profile">
                                    <img th:src="@{/img/profile-bg.jpg}" alt="Image placeholder" class="card-img-top">
                                    <div class="row justify-content-center">
                                        <div class="col-4 col-lg-4 order-lg-2">
                                            <div class="mt-n4 mt-lg-n6 mb-4 mb-lg-0">
                                                <img th:src="${user.profileImage != null ? '/uploads/' + user.profileImage.filePath : '/default-profile.png'}"
                                                     class="rounded-circle img-fluid border border-2 border-white"
                                                     alt="Profile Image">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="text-center mt-4">
                                            <h5 th:text="${user.userName}">사용자 이름</h5>
                                            <div class="user-info">
                                                <div class="user-info">
                                                    <p th:if="${user.email != null and !user.email.isEmpty()}">
                                                        <i class="fas fa-envelope mr-2"></i>
                                                        <span th:text="${user.email}">사용자 이메일</span>
                                                    </p>
                                                    <p th:if="${user.phoneNum != null and !user.phoneNum.isEmpty()}">
                                                        <i class="fas fa-phone mr-2"></i>
                                                        <span th:text="${user.phoneNum}">전화번호</span>
                                                    </p>
                                                    <p th:if="${user.streetaddr != null and !user.streetaddr.isEmpty()}">
                                                        <i class="fas fa-map-marker-alt mr-2"></i>
                                                        <span th:text="${user.streetaddr}">주소</span>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="user-actions mt-4">
                                                <a th:href="@{/mypage/edit/{userId}(userId=${user.userId})}" class="btn btn-primary btn-sm">
                                                    프로필 수정
                                                </a>
                                                <a th:href="@{/mypage/useamount-detail/{userId}(userId=${user.userId}, year=${year})}" class="btn btn-info btn-sm usage_btn">
                                                    사용량 보기
                                                </a>
                                                <a th:href="@{/challenge}" class="btn btn-success btn-sm">
                                                    챌린지 현황
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                        <!-- 프로필 카드 -->

                        <!-- 비로그인 카드 -->
                        <th:block th:if="${user == null}">
                            <div class="col-md-3">
                                <div class="card card-profile">
                                    <img th:src="@{/img/profile-bg.jpg}" alt="Image placeholder" class="card-img-top">
                                    <div class="row justify-content-center">
                                        <div class="col-4 col-lg-4 order-lg-2">
                                            <div class="mt-n4 mt-lg-n6 mb-4 mb-lg-0">
                                                <img src="/default-profile.png"
                                                     class="rounded-circle img-fluid border border-2 border-white"
                                                     alt="Default Profile Image">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="text-center mt-4">
                                            <h5>게스트</h5>
                                            <div class="user-info">
                                                <p>로그인하여 서비스를 이용해보세요.</p>
                                            </div>
                                            <div class="user-actions mt-4">
                                                <a th:href="@{/loginForm}" class="btn btn-primary btn-sm">
                                                    로그인
                                                </a>
                                                <a th:href="@{/join}" class="btn btn-info btn-sm">
                                                    회원가입
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>


                        <!-- 대시보드 및 차트 -->
                        <div class="col-md-9">
                            <!-- 대시보드 -->
                            <div class="row dashboard-row">
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body">
                                            <h5 class="card-title">현재 달 전기 사용량</h5>
                                            <p class="card-text" th:text="${currentElectricity}">현재 달 전기 사용량</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body">
                                            <h5 class="card-title">전월 대비 전기 증감률</h5>
                                            <p class="card-text" id="electricityDiffMsg" th:text="${electricityDiffMsg}">전기 사용량 증감률 메시지</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body">
                                            <h5 class="card-title">현재 달 가스 사용량</h5>
                                            <p class="card-text" id="currentGas" th:text="${currentGas}">현재 달 가스 사용량</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body">
                                            <h5 class="card-title">전월 대비 가스 증감률</h5>
                                            <p class="card-text" id="gasDiffMsg" th:text="${gasDiffMsg}">가스 사용량 증감률 메시지</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 차트 -->
                            <div class="chart-container">
                                <h6 class="chart-title">서울 및 경기도 시군구별 전기 및 가스 사용량</h6>
                                <div class="chart-controls">
                                    <label for="regionSelect" class="region_select">지역 선택</label>
                                    <select id="regionSelect" class="region_select_option">
                                        <option value="seoul" selected>서울</option>
                                        <option value="gyeonggi" >경기도</option>
                                    </select>

                                    <select id="seoulSubSelect" class="region_select_option">
                                        <option value="gangnam" selected>강남</option>
                                        <option value="gangbuk">강북</option>
                                    </select>

                                    <select id="gyeonggiSubSelect" style="display: none;">
                                        <option value="gyeongginorth">북부</option>
                                        <option value="gyeonggicentral">중부</option>
                                        <option value="gyeonggisouth">남부</option>
                                    </select>
                                </div>
                                <canvas id="usageChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </body>
    </div>
</layout:html>
