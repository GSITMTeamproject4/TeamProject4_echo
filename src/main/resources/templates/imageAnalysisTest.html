<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teachable Machine with Spring Boot</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
</head>
<body>
<input type="file" id="image-upload" accept="image/*" onchange="showPreview(event)">
<div id="preview-container">
    <img id="image-preview" src="#" alt="Image Preview" style="display:none; max-width: 200px; max-height: 200px;">
</div>
<button type="button" onclick="predict()">Analyze Image</button>
<div id="label-container"></div>
<script type="text/javascript">
    const URL = "/";

    let model, labelContainer, maxPredictions;

    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        labelContainer = document.getElementById("label-container");
        labelContainer.appendChild(document.createElement("div"));
    }

    function showPreview(event) {
        const input = event.target;
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const imgElement = document.getElementById('image-preview');
                imgElement.src = e.target.result;
                imgElement.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    async function predict() {
        const imgElement = document.getElementById('image-preview');
        if (imgElement.src && imgElement.src !== "#") {
            const prediction = await model.predict(imgElement);

            let highestPrediction = prediction[0];
            for (let i = 1; i < prediction.length; i++) {
                if (prediction[i].probability > highestPrediction.probability) {
                    highestPrediction = prediction[i];
                }
            }

            labelContainer.childNodes[0].innerHTML = highestPrediction.className;
        } else {
            alert("Please upload an image first.");
        }
    }

    // Initialize the model
    init();
</script>
</body>
</html>
